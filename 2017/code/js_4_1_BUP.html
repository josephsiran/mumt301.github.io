<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Music APIs</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../css/main.css">
	<script src="../js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	<style>		
		.div-table {
			display: table;         
			width: auto;         
			margin: auto;
			background-color: #eee;         
			border: 1px solid #666666;         
			border-spacing: 5px; 
			font-size: 16px;
			text-align: center;
			vertical-align: middle;

		}
		.div-table-row {
			display: table-row;
			width: auto;
			height:auto;
			clear: both;
			/*text-align: center;*/
		}
		.div-table-col {
			float: left; 
			display: table-column;         
			width: 300px;         
			background-color: #ccc;
			/*text-align: center;*/
		}

	</style>
</head>

<body id="body">
	<div id="container">
		<!-- <h1 id="title">Music APIs</h1> -->
		<h2>Assignment 6 Redux</h2> 
		<p>Retrieve all albums for a given user-entered artist, show just the year of the release year, create a link to the MusicBrainz page for that its release-group, and display the album cover.</p>
		
		<form id="artist" class="center">
			Artist name?
			<input type="text" name="artist">
			<input type="button" onclick="albumdiscographyRetriever()" value="Retrieve albums!">
		</form>
		<p></p>

      <div id="releasesOutput" class="div-table"></div>

		<script>
			function httpGet(theUrl) {
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.open("GET", theUrl, false);
				xmlHttp.send();
				return xmlHttp.responseXML;
			}


			function queryArtist(artistName) {

				// Create the MB call to retrieve the MBID
				mbBaseURL = "https://musicbrainz.org/ws/2/";
				mbResource = "artist?query=";
				queryURL = mbBaseURL + mbResource + artistName;
				// console.log(queryURL);

				// Create the HTTP request 
				retrievedData = httpGet(queryURL);
				// console.log(retrievedData)

				artistData = retrievedData.getElementsByTagName("artist")[0];
				artistMBID = artistData.id;
				// console.log(artistMBID);
				return artistMBID

				// document.getElementById("mbid").innerHTML = artistMBID;

			}

			function queryReleasegroup(artistMBID) {
				// Create the MB call to retrieve the release-group albums
				// http://musicbrainz.org/ws/2/release-group?artist=f467181e-d5e0-4285-b47e-e853dcc89ee7&type=album
				// console.log(artistMBID)
				mbBaseURL = "https://musicbrainz.org/ws/2/";
				mbResource = "release-group?artist=";
				resourceType = "&type=album";
				queryURL = mbBaseURL + mbResource + artistMBID + resourceType;
				// console.log(queryURL);

				// Create the HTTP request 
				albumData = httpGet(queryURL);
				// console.log(albumData)
				return albumData

			}

			function albumdiscographyRetriever() {
				// Cleaning the table before writing to it
				outputTable = document.getElementById('releasesOutput');
				while (outputTable.hasChildNodes()) {
					outputTable.removeChild(outputTable.firstChild);
				}

				// Formatting table header 
             	tableRow = document.createElement('div');
             	tableRow.setAttribute('class', 'div-table-row');

             	tableCol1 = document.createElement('div');
             	tableCol1.setAttribute('class', 'div-table-col');
             	tableCol1.innerHTML = "Release Name";
             	tableCol2 = document.createElement('div');
             	tableCol2.setAttribute('class', 'div-table-col');
             	tableCol2.innerHTML = "Year of Release";
             	tableCol3 = document.createElement('div');
             	tableCol3.setAttribute('class', 'div-table-col');
             	tableCol3.innerHTML = "Cover Art";

             	tableRow.appendChild(tableCol1);
             	tableRow.appendChild(tableCol2);
             	tableRow.appendChild(tableCol3);

             	document.getElementById('releasesOutput').append(tableRow);

				// getting the data from the form
				var artistNameUser = document.getElementById("artist");
				artistName = artistNameUser.elements["artist"].value;
				// console.log(artistName);

				// retrieving MBID
				artistMBID = queryArtist(artistName);

				// retrieving albumDiscography
				albumData = queryReleasegroup(artistMBID);

				// Parsing the results
				releaseGroup = albumData.getElementsByTagName('release-group')
				console.log(releaseGroup)

				for (var r = 0; r < releaseGroup.length; r++) {
					// console.log(releases[r]);
					albumTitle = releaseGroup[r].getElementsByTagName('title')[0].innerHTML
					albumreleaseDate = releaseGroup[r].getElementsByTagName('first-release-date')[0].innerHTML
					albumreleaseYear = albumreleaseDate.split('-')[0]

					// creating the table  row
					tableRow = document.createElement('div')
					tableRow.setAttribute('class', 'div-table-row')

					// creating the table columns
					tableCol = document.createElement('div')
					tableCol.setAttribute('class', 'div-table-col')
					// tableCol.innerHTML = albumTitle

					// creating an link to the album's page
					releasegroupMBID = releaseGroup[r].getAttribute('id')
					releasegroupLink = "https://musicbrainz.org/release-group/" + releasegroupMBID
					
					// creating the anchor link 
					albumLink = document.createElement('a');
					albumLink.setAttribute('class', "div-table-col");
					albumLink.setAttribute('target', "_blank");
					albumLink.setAttribute('href', releasegroupLink);
					albumLink.innerHTML = releaseGroup[r].getElementsByTagName('title')[0].innerHTML;
					tableCol.append(albumLink)
					tableRow.append(tableCol)

					// Creating second column for year
					tableCol = document.createElement('div')
					tableCol.setAttribute('class', 'div-table-col')
					tableCol.innerHTML = albumreleaseYear
					tableRow.appendChild(tableCol)


					// Creating third column for cover art
					tableCol = document.createElement('div')
					tableCol.setAttribute('class', 'div-table-col')
					// Fecthing the release group cover 
					releaseGroupImageURL = "https://coverartarchive.org/release-group/" + releasegroupMBID + "/front-250";
					// <img src="url">
					releaseGroupImage = document.createElement('img');
					releaseGroupImage.setAttribute('src', releaseGroupImageURL);


					tableCol.appendChild(releaseGroupImage);
					tableRow.appendChild(tableCol)

					// Appending the row to the table
					document.getElementById('releasesOutput').append(tableRow);

					// 

				}

			}


		</script>



</body>

</html>

<!-- In-class Exercise -->
<!-- Print just the year -->
<!-- Add a link to the album's page on MusicBrainz -->
<!-- Adding album pictures -->
