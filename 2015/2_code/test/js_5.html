<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Music APIs</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="./css/main.css">
	<script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	<style>
		table,
		tr,
		th,
		td {
			margin-left: auto;
			margin-right: auto;
			text-align: center;
			font-size: 15px;
			border: 2px solid green;
			border-collapse: collapse;
			font-family: "Lucida Grande";
			background-color: #ffffff;
		}
		
		tr,
		td {
			font-style: bold;
			padding: 5px;
		}
		
		th {
			background-color: #a7c942;
			color: #ffffff;
		}
		
		.center {
			margin: auto;
		}
	</style>
</head>

<body id="body">
	<h1 id="title">Music APIs</h1>
	<div id="container">
		<h2>In-class exercise</h2> 
		<p>Let the user enter a song's name and retrieve a list of existing recordings for that song's name in 
		<a href="https://musicbrainz.org/doc/Development/XML_Web_Service/Version_2">the Musicbrainz API</a>.</p>

		<!-- form for getting user's data		 -->
		<form id="song">
			Song name?
			<input type="text" name="song">
			<input type="button" onclick="querySong()" value="Search for recordings of this song!">
		</form>

		<p id="musicbrainz_query"></p>
		<p id="musicbrainz_response"></p>
		<p id="query_line" class="center"></p>
		<p id="musicbrainz_parsed_response"></p>

	</div>

	<script>
		function httpGet(theUrl) {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.open("GET", theUrl, false);
			xmlHttp.send();
			return xmlHttp.responseXML;
		}

		function querySong() {
			// 			emptying previous table
			document.getElementById("musicbrainz_parsed_response").innerHTML = "";

			// 			creating the query
			var x = document.getElementById("song");
			song = x.elements["song"].value;

			queryURL = "http://musicbrainz.org/ws/2/recording?query=".concat(song);
			retrievedData = httpGet(queryURL) // all data gest stored in retrievedData
				// 			console.log(retrievedData)
			recordings = retrievedData.getElementsByTagName("recording")


			// 			create the table
			var table = document.createElement('table');
			var tr = document.createElement('tr');
			var th1 = document.createElement('th');
			var th2 = document.createElement('th');
			table.appendChild(tr);
			tr.appendChild(th1);
			th1.innerHTML = 'Artist name'
			tr.appendChild(th2);
			th2.innerHTML = 'Release Name'

			// 			parsing the data iteratively				
			for (i = 0; i < recordings.length; i++) {
				// 				getting the data from musicbrainz response
				artist_name = recordings[i].getElementsByTagName("name")[0].innerHTML;
				release = recordings[i].getElementsByTagName("release")[0];
				release_name = release.getElementsByTagName("title")[0].innerHTML;

				// 				appending data to table
				var tr = document.createElement('tr');
				var td = document.createElement('td');
				tr.appendChild(td);
				tr.innerHTML = artist_name;
				tr.appendChild(td);
				td.innerHTML = release_name;
				table.appendChild(tr);
			}

			// 			Writing the header line
			document.getElementById("query_line").innerHTML = "The song " + song + " appears in the following releases"
				// 			appending the table to the DOM
			document.getElementById("musicbrainz_parsed_response").appendChild(table);
		}
	</script>

</body>

</html>